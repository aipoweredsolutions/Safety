# SafetyLearn - Interactive Safety Education Platform

A comprehensive safety education platform for children and teenagers (ages 5-19) featuring personalized video content, AI-powered conversations with voice responses, and engaging lessons.

## Features

- **Age-Appropriate Content**: Tailored lessons for different age groups (5-10, 11-15, 16-19)
- **Interactive Lessons**: Engaging content with scenarios, quizzes, and practical tips
- **AI Safety Assistant**: 24/7 Gemini-powered chat for safety questions and guidance
- **Voice Responses**: Eleven Labs integration for spoken AI responses with age-appropriate voices
- **Personalized Video Content**: Tavus integration for customized safety videos
- **AI Lesson Generation**: Custom lessons generated by AI based on user topics and age
- **Achievement System**: Gamified learning with badges, points, and progress tracking
- **Daily Safety Stories**: Interactive stories with scenarios for daily learning
- **Responsive Design**: Works seamlessly on desktop and mobile devices

## Technology Stack

- **Frontend**: React 18, TypeScript, Tailwind CSS
- **Routing**: React Router DOM
- **Icons**: Lucide React
- **Backend**: Supabase Edge Functions
- **AI**: Google Gemini API
- **Text-to-Speech**: Eleven Labs API
- **Video**: Tavus AI for personalized videos
- **Build Tool**: Vite

## Getting Started

### Prerequisites

- Node.js 18+ 
- Supabase account
- Google Gemini API key
- Eleven Labs API key
- Tavus API key

### Installation

1. Clone the repository
2. Install dependencies:
   ```bash
   npm install
   ```

3. Set up environment variables:
   ```bash
   cp .env.example .env
   ```
   Fill in your Supabase URL and anon key.

4. Start the development server:
   ```bash
   npm run dev
   ```

## Project Structure

```
src/
├── components/          # Reusable UI components
│   ├── AgeSelector.tsx
│   ├── ChatInterface.tsx  # Enhanced with Eleven Labs TTS
│   ├── Header.tsx
│   ├── LessonCard.tsx
│   ├── Navigation.tsx
│   ├── UserProfile.tsx
│   ├── DailySafetyStory.tsx
│   ├── TavusVideoPlayer.tsx
│   └── GeminiLessonViewer.tsx
├── data/               # Static data and content
│   ├── achievements.ts
│   ├── lessons.ts
│   └── dailyStories.ts
├── hooks/              # Custom React hooks
│   └── useLocalStorage.ts
├── pages/              # Page components
│   ├── Achievements.tsx
│   ├── Chat.tsx
│   ├── Dashboard.tsx
│   ├── LandingPage.tsx
│   ├── Lessons.tsx
│   ├── GeminiLessons.tsx
│   ├── PersonalizedVideos.tsx
│   └── LessonViewer.tsx
├── services/           # API services
│   ├── geminiService.ts
│   ├── geminiLessonService.ts
│   ├── elevenLabsService.ts
│   ├── lessonService.ts
│   └── authService.ts
├── types/              # TypeScript type definitions
│   └── index.ts
└── App.tsx            # Main application component
```

## Supabase Edge Functions

The following edge functions are included in the project and are automatically deployed when using the "Connect to Supabase" button:

### gemini-chat
Handles AI-powered chat conversations with age-appropriate responses.

**Endpoint**: `/functions/v1/gemini-chat`

### gemini-quiz
Generates personalized explanations for quiz answers.

**Endpoint**: `/functions/v1/gemini-quiz`

### gemini-lesson-generator
Generates complete AI lessons with scenarios, quizzes, and voice narration.

**Endpoint**: `/functions/v1/gemini-lesson-generator`

### gemini-lesson-suggestions
Provides personalized lesson topic suggestions based on age and progress.

**Endpoint**: `/functions/v1/gemini-lesson-suggestions`

### eleven-labs-tts
Converts text to speech using Eleven Labs API with age-appropriate voices.

**Endpoint**: `/functions/v1/eleven-labs-tts`

**Request**:
```json
{
  "text": "Hello, this is a safety message",
  "userAge": 12,
  "voiceId": "optional-specific-voice-id"
}
```

**Response**: Audio file (MP3 format)

### tavus-cvi-agent
Creates personalized video conversations using Tavus AI.

**Endpoint**: `/functions/v1/tavus-cvi-agent`

**Request**:
```json
{
  "user_input": "Create a safety video about online privacy",
  "user_name": "Alex",
  "user_age": 14
}
```

**Response**:
```json
{
  "success": true,
  "conversation_url": "https://tavus.io/conversations/...",
  "conversation_id": "conv_123...",
  "status": "created"
}
```

## Voice Integration

The platform uses Eleven Labs to provide age-appropriate voice responses:

- **Ages 5-10**: Charlotte - Friendly young female voice
- **Ages 11-15**: Adam - Clear educational voice
- **Ages 16-19**: Josh - Professional male voice

Users can toggle voice responses on/off and control playback for each AI message.

## Personalized Video Integration

The platform uses Tavus AI to create personalized safety videos:

- **Custom Content**: Videos are generated based on user's name and age group
- **Age-Appropriate**: Content and language adapted for different age ranges
- **Interactive**: Users can engage with personalized video conversations
- **Secure**: All videos are created securely and privately for each user

## Age-Appropriate Content

The platform provides tailored content for three age groups:

- **5-10 years (Young Learners)**: Basic safety rules, simple vocabulary, encouraging language
- **11-15 years (Teen Guardians)**: Building independence, practical tips, clear explanations
- **16-19 years (Young Adults)**: Advanced safety, life skills, professional advice

## Safety Features

- **COPPA Compliant**: Designed with child privacy in mind
- **Age Verification**: Content filtering based on user age
- **Emergency Resources**: Quick access to emergency contacts
- **Trusted Adult Emphasis**: Consistent messaging about seeking help from trusted adults
- **Positive Reinforcement**: Encouraging and supportive learning environment
- **Accessible Learning**: Voice responses for improved accessibility

## AI-Powered Features

### Custom Lesson Generation
- Generate personalized safety lessons on any topic
- Age-appropriate content and language
- Complete with scenarios, quizzes, and voice narration
- Adaptive difficulty based on user age group

### Intelligent Chat Assistant
- 24/7 AI safety assistant powered by Google Gemini
- Age-appropriate responses and guidance
- Voice responses with Eleven Labs integration
- Conversation history and context awareness

### Personalized Videos
- Custom video content created with Tavus AI
- User's name integrated throughout the video
- Age-appropriate scenarios and examples
- Interactive video conversations

### Daily Safety Stories
- Interactive stories with decision-making scenarios
- Age-appropriate moral lessons
- Progress tracking and completion rewards

## API Setup

### Setting up API Keys

To use the AI features, voice responses, and personalized videos, you'll need to set up API keys in your Supabase project:

1. **Gemini API Key**:
   - Visit [Google AI Studio](https://makersuite.google.com/app/apikey)
   - Create a new API key
   - Add it to your Supabase project secrets as `GEMINI_API_KEY`

2. **Eleven Labs API Key**:
   - Visit [Eleven Labs](https://elevenlabs.io)
   - Sign up or log in to your account
   - Navigate to your profile settings
   - Copy your API key
   - Add it to your Supabase project secrets as `ELEVEN_LABS_API_KEY`

3. **Tavus API Keys**:
   - Visit [Tavus](https://tavus.io)
   - Create an account and get your API credentials
   - Add the following to your Supabase project secrets:
     - `TAVUS_API_KEY`: Your Tavus API key
     - `TAVUS_REPLICA_ID`: Your replica ID for video generation
     - `TAVUS_PERSONA_ID`: Your persona ID for conversation style

### Setting Supabase Secrets

You can set these secrets using the Supabase CLI or dashboard:

#### Using Supabase CLI:
```bash
# Set Gemini API key
supabase secrets set GEMINI_API_KEY=your_gemini_api_key

# Set Eleven Labs API key
supabase secrets set ELEVEN_LABS_API_KEY=your_eleven_labs_api_key

# Set Tavus API credentials
supabase secrets set TAVUS_API_KEY=your_tavus_api_key
supabase secrets set TAVUS_REPLICA_ID=your_tavus_replica_id
supabase secrets set TAVUS_PERSONA_ID=your_tavus_persona_id
```

#### Using Supabase Dashboard:
1. Go to your Supabase project dashboard
2. Navigate to Settings > Edge Functions
3. Click on "Environment Variables"
4. Add each secret with its corresponding value

### Troubleshooting API Issues

#### Tavus API Errors

**Error: "Invalid access token" (401)**
- Check that your `TAVUS_API_KEY` is correctly set in Supabase secrets
- Verify the API key is valid and not expired in your Tavus dashboard
- Ensure your Tavus account has sufficient credits

**Error: "TAVUS_REPLICA_ID not configured"**
- Set your replica ID using: `supabase secrets set TAVUS_REPLICA_ID=your_replica_id`
- Get your replica ID from your Tavus dashboard

**Error: "TAVUS_PERSONA_ID not configured"**
- Set your persona ID using: `supabase secrets set TAVUS_PERSONA_ID=your_persona_id`
- Get your persona ID from your Tavus dashboard

#### General API Issues

**Error: "Configuration missing"**
- Ensure all required API keys are set as Supabase secrets
- Check that your Supabase environment variables are correctly configured
- Verify your `.env` file contains the correct Supabase URL and anon key

**Error: "Rate limit exceeded"**
- Wait a few moments before trying again
- Check your API usage limits in the respective service dashboards
- Consider upgrading your API plan if needed

## Database Schema

The platform uses a comprehensive database schema with the following main tables:

- **users**: User profiles and basic information
- **user_progress**: Learning progress, streaks, and completed lessons
- **user_achievements**: Achievement tracking and unlocking
- **lessons**: Core lesson content and metadata
- **lesson_key_points**: Structured key learning points
- **lesson_scenarios**: Practice scenarios for lessons
- **lesson_quiz_questions**: Quiz questions and answers
- **daily_stories**: Daily safety stories
- **daily_story_scenarios**: Interactive scenarios for stories

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Support

For support, please contact [support@safetylearn.com] or create an issue in the repository.